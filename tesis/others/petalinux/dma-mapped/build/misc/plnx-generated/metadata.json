{

"virtual/fsbl":{
	"JSON_FLAGS":"CONFIG_SUBSYSTEM_COMPONENT_BOOTLOADER_AUTO_FSBL",
	"globalvar":{
		"export":"PETALINUX",
		"do_configure[noexec]":["=","!CONFIG_SUBSYSTEM_AUTOCONFIG_FSBL", "1"],
		"YAML_BSP_CONFIG":"stdin stdout",
		"YAML_BSP_CONFIG[stdin]":"set,CONFIG_SUBSYSTEM_SERIAL_IP_NAME",
		"YAML_BSP_CONFIG[stdout]":"set,CONFIG_SUBSYSTEM_SERIAL_IP_NAME",
		"XSCTH_WS":"${TOPDIR}/../components/plnx_workspace",
		"XSCTH_REPO":["?=","1","none"]
	}
	},

"virtual/bootloader":{
	"globalvar":{
		 "SRC_URI":["=","CONFIG_SUBSYSTEM_COMPONENT_U__BOOT_NAME_REMOTE","CONFIG_SUBSYSTEM_COMPONENT_U__BOOT_NAME_REMOTE_DOWNLOAD_PATH"],
		"SRCREV":["=","CONFIG_SUBSYSTEM_COMPONENT_U__BOOT_NAME_REMOTE","CONFIG_SUBSYSTEM_COMPONENT_U__BOOT_NAME_REMOTE_REFERENCE"],
		"SRC_URI_append":"file://config.cfg file://platform-auto.h",
		"FILESEXTRAPATHS_append":":${THISDIR}/configs:",
		"DEPENDS_append":" kern-tools-native device-tree-generation",
		"UBOOT_MAKE_TARGET_append":" EXT_DTB=${DEPLOY_DIR_IMAGE}/${MACHINE}-system.dtb"
	},
	"DefineMethod":{
		"do_configure_append ()":{
			"CONFIG_SUBSYSTEM_UBOOT_CONFIG_PETALINUX":
				["install ${WORKDIR}/platform-auto.h ${S}/include/configs/",
				"install ${WORKDIR}/platform-top.h ${S}/include/configs/"]
		}
	}
	},

"virtual/kernel":{
	"globalvar":{
		"SRC_URI":["=","CONFIG_SUBSYSTEM_COMPONENT_LINUX__KERNEL_NAME_REMOTE","CONFIG_SUBSYSTEM_COMPONENT_LINUX__KERNEL_NAME_REMOTE_DOWNLOAD_PATH"],
		"SRCREV":["=","CONFIG_SUBSYSTEM_COMPONENT_LINUX__KERNEL_NAME_REMOTE","CONFIG_SUBSYSTEM_COMPONENT_LINUX__KERNEL_NAME_REMOTE_REFERENCE"],
		"SRC_URI_append":"file://plnx_kernel.cfg",
		"KERNEL_IMAGETYPE_zynq":"zImage",
		"RDEPENDS_kernel-base":"",
		"FILESEXTRAPATHS_append":":${THISDIR}/configs"
	},
	"DefineMethod":{
		"do_configure_append ()":{"CONFIG_SUBSYSTEM_COMPONENT_LINUX__KERNEL_NAME_EXT__LOCAL__SRC":
			 ["merge_config.sh -m ${B}/.config ${@\" \".join(find_cfgs(d))}",
			"oe_runmake -C ${S} O=${B} oldconfig"]},
		"do_deploy_append ()":{"ALL":
			["install -m 0644 ${D}/boot/System.map-${KERNEL_VERSION} ${DEPLOY_DIR_IMAGE}/System.map.linux",
			"install -m 0644 ${D}/boot/vmlinux-${KERNEL_VERSION} ${DEPLOY_DIR_IMAGE}/vmlinux"]}
	}
	},

"virtual/dtb":{
	"JSON_FLAGS":"CONFIG_SUBSYSTEM_AUTOCONFIG_DEVICE__TREE",
	"globalvar":{
		"export":"PETALINUX",
		"XSCTH_WS":"${TOPDIR}/../components/plnx_workspace",
		"do_compile[deptask]":["+=","1","virtual/kernel:do_shared_workdir"],
		"YAML_BSP_CONFIG":"console_device main_memory pcw_dts",
		"YAML_BSP_CONFIG[console_device]":"set,CONFIG_SUBSYSTEM_SERIAL_IP_NAME",
		"YAML_BSP_CONFIG[main_memory]":"set,CONFIG_SUBSYSTEM_MEMORY_IP_NAME",
		"YAML_BSP_CONFIG[pcw_dts]":"set,pcw.dtsi",
		"YAML_FILE_PATH":"${WORKDIR}/devicetree.yaml",
		"XSCTH_MISC":"-yamlconf ${YAML_FILE_PATH}",
		"sysconf":"${TOPDIR}/../project-spec/configs",
		"FILESEXTRAPATHS_append":":${sysconf}",
		"SRC_URI_append":"file://config",
		"dts_dir":"${XSCTH_WS}/${XSCTH_PROJ}",
		"padding_size":"CONFIG_SUBSYSTEM_DTB_PADDING_SIZE",
		"dtc_include":"${XSCTH_WS}/${XSCTH_PROJ}",
		"dtc_kernel_include":"CONFIG_SUBSYSTEM_DEVICE_TREE_INCLUDE_DIR",
		"inherit":"xsctyaml"
	},
	"DefineMethod":{
		"do_configure_append ()":{"ALL":
			["script=\"${PETALINUX}/etc/hsm/scripts/petalinux_hsm_bridge.tcl\"",
			"data=${PETALINUX}/etc/hsm/data/",
			"eval xsct ${script} -c ${WORKDIR}/config \\",
			"-hdf ${dts_dir}/hardware_description.hdf -repo ${S}\\",
			"-data ${data} -sw ${dts_dir} -o ${dts_dir} -a \"soc_mapping\""]},
		"do_compile ()":{"ALL":
			["install ${WORKDIR}/system-top.dts ${dts_dir}/system-top.dts",
			"dtc_args=\"-i \"${dts_dir}\" \"",
			"cpp_args=\"-I \"${dts_dir}\" \"",
			"if [ ! -z ${dtc_include} ];then",
			"dtc_args=\"${dtc_args} -i ${dtc_include}\"",
			"cpp_args=\"${cpp_args} -I ${dtc_include}\"",
			"fi",
			"if [ ! -z ${dtc_kernel_include} ];then",
			"dtc_args=\"${dtc_args} -i ${dtc_kernel_include}\"",
			"cpp_args=\"${cpp_args} -I ${dtc_kernel_include}\"",
			"fi",
			"${CPP} -E -nostdinc -Ulinux ${cpp_args} \\",
			"-x assembler-with-cpp -o ${dts_dir}/${MACHINE}-system.dts \\",
			"${dts_dir}/system-top.dts",
			"dtc -O dtb -o ${dts_dir}/${MACHINE}-system.dtb -b 0 -p ${padding_size} \\",
			"-I dts ${dtc_args} ${dts_dir}/${MACHINE}-system.dts",
			"dtc -O dts -o ${dts_dir}/${MACHINE}-system.dts  \\",
			"-I dtb  ${dts_dir}/${MACHINE}-system.dtb"]}
	}
	},

"virtual/hdf":{
	"globalvar":{
		"HDF_PATH":"${TOPDIR}/../project-spec/hw-description/system.hdf",
		"HDF_BASE":"file://"
	}
	}

}
